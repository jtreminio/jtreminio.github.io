<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"> <meta name="description" content="Juan Treminio - Dallas based senior web developer"> <meta name="keywords" content=""> <meta property="og:title" content="Docker PHP/PHP-FPM Configuration via Environment Variables - Juan Treminio - Senior Web Developer Blog"> <meta property="og:type" content="article"> <meta property="og:description" content="ed: If you want to run the containers right now, jump ahead to How to Use the Images. "> <meta property="article:tag" content="docker"> <meta property="article:tag" content="php"> <meta property="og:url" content="https://jtreminio.com/blog/docker-php-php-fpm-configuration-via-environment-variables"> <meta property="og:site_name" content="Juan Treminio - Senior Web Developer Blog"> <title>Docker PHP/PHP-FPM Configuration via Environment Variables - Juan Treminio - Senior Web Developer Blog</title> <link rel="shortcut icon" type="image/png" href="/static/favicon/favicon.ico"/> <link rel="shortcut icon" type="image/png" href="/static/favicon/favicon-96x96.png" sizes="96x96"/> <link rel="shortcut icon" type="image/png" href="/static/favicon/favicon-32x32.png" sizes="32x32"/> <link rel="canonical" href="https://jtreminio.com/blog/docker-php-php-fpm-configuration-via-environment-variables"> <link href="//cdn.jsdelivr.net/npm/bootstrap-no-fonts-no-js@3.3.7/css/bootstrap.min.css" rel="stylesheet" type="text/css"/> <link href="//cdnjs.cloudflare.com/ajax/libs/startbootstrap-clean-blog/3.3.7/css/clean-blog.min.css" rel="stylesheet" type="text/css"/> <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"/> <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"/> <script src="//cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script> <link rel="stylesheet" href="/static/css/rouge.scss"/> <link rel="stylesheet" href="/static/css/custom.scss?1642996622"/> <link rel="stylesheet" href="/static/css/dark.scss?1642996622" data-style="dark"/> </head> <body> <nav class="navbar navbar-default navbar-expand-md navbar-custom navbar-fixed-top is-fixed is-visible"> <div class="container-fluid"> <div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand hidden-xs hidden-sm" href="/">Juan Treminio - Senior Web Developer Blog</a> <a class="navbar-brand visible-xs visible-sm" href="/">Juan Treminio - Developer Blog</a> </div> <div class="collapse navbar-collapse" id="main-navbar-collapse"> <ul class="nav navbar-nav navbar-right"> <li><a href="/">Blog</a></li> <li><a href="/about">About</a></li> <li><a href="/hire-me">Hire Me</a></li> <li> <a class="btn theme-toggle"> <span class="theme-dark"><i data-feather="moon"></i> Dark Theme</span> <span class="theme-light"><i data-feather="sun"></i> Light Theme</span> </a> </li> </ul> </div> </div> </nav> <header class="intro-header"> <div class="container"> <div class="row"> <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"> <div class="post-heading"> <h1>Docker PHP/PHP-FPM Configuration via Environment Variables</h1> <h2 class="subheading">PHP Docker Container Image with Full Environment Variable INI Configuration</h2> <span class="meta">Posted on Nov 15, 2018 <br/> <i class="feather icon-tag"></i>Tags <a href="/tags#docker">docker</a>, <a href="/tags#php">php</a> </span> </div> </div> </div> </div> </header> <article> <div class="container"> <div class="row"> <div class="post col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"> <p><em>ed: If you want to run the containers right now, jump ahead to <strong><a href="#how-to-use-the-images">How to Use the Images</a></strong>.</em></p> <p>For several months now I have been working on <a href="https://puphpet.com">PuPHPet.com’s</a> replacement. It is a Docker-based GUI functionally similar to PuPHPet.</p> <p>Docker, like Vagrant, allows sharing directories and files from the host to the container/VM. Unlike Vagrant, Docker images are easy to create, easy to share and easy to configure.</p> <p>One of the most convenient differences is that with Docker containers you can pass flags to the container which can be used for configuration (if the image was created with this in mind).</p> <p>For example, with the <a href="https://hub.docker.com/_/mariadb/">MariaDB image</a> you create a new container and define the database credentials:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="se">\</span>
    <span class="nt">-e</span> <span class="nv">MYSQL_DATABASE</span><span class="o">=</span>dbname <span class="se">\</span>
    <span class="nt">-e</span> <span class="nv">MYSQL_USER</span><span class="o">=</span>dbuser <span class="se">\</span>
    <span class="nt">-e</span> <span class="nv">MYSQL_PASSWORD</span><span class="o">=</span>dbpassword <span class="se">\</span>
    mariadb
</pre></td></tr></tbody></table></code></pre></div></div> <p>This creates a new MariaDB container with a database named <code class="language-plaintext highlighter-rouge">dbname</code>, user <code class="language-plaintext highlighter-rouge">dbuser</code> and password <code class="language-plaintext highlighter-rouge">dbpassword</code>. You do not need to create a separate configuration file, the above takes care of that for you!</p> <p>What if we could do the same for a PHP container? Having to keep track of a separate INI file for both PHP and PHP-FPM is not nearly as smooth as how MariaDB’s image can be configured.</p> <h2 id="our-goals">Our Goals</h2> <p>I will talk you through the thought process required for creating a Docker image that is capable of configuring its service using environment variable flags:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">-e</span> <span class="o">{</span>ENV_NAME<span class="o">}={</span>ENV_VALUE<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>I will detail the gotchas you would encounter trying to create this for yourself from scratch, and the solutions I came up with and implemented.</p> <h2 id="quick-introduction-to-docker-images">Quick Introduction to Docker Images</h2> <p>It will definitely help if you know Docker at a usable level. If you know Docker enough to only run pre-built images then I hope this will help solidify your understanding of how Docker works.</p> <p>That said I am not an expert in the internal workings of Docker, and I might get some things wrong.</p> <p>Docker <em>images</em> are blueprints for Docker <em>containers</em>. You need an image to run one or more instances which are known as containers.</p> <p>An image can be grabbed from the <a href="https://hub.docker.com">Docker Hub</a> or you can easily create your own images by writing a <em>Dockerfile</em>. This is a simple text file that contains instructions for creating your image.</p> <p>Unless you are doing some hardcore stuff, you always start with an existing base image. For example, <code class="language-plaintext highlighter-rouge">FROM ubuntu:18.04</code> means we will start with an Ubuntu 18.04 image to create our final image.</p> <p>You can have as many layers as you want, with each new image extending the parent and adding more functionality. That is exactly what we will end up doing today.</p> <h2 id="php-ini-with-environment-variables-env-vars">PHP INI with Environment Variables (env vars)</h2> <p>A little-known fact is that PHP’s INI file (and PHP-FPM conf, too!) can be configured normally,</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nv">display_errors</span><span class="o">=</span>0
<span class="nv">error_reporting</span><span class="o">=</span>Off
date.timezone<span class="o">=</span>UTC
</pre></td></tr></tbody></table></code></pre></div></div> <p>but it can also read env vars!</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nv">display_errors</span><span class="o">=</span><span class="k">${</span><span class="nv">DISPLAY_ERRORS</span><span class="k">}</span>
<span class="nv">error_reporting</span><span class="o">=</span><span class="k">${</span><span class="nv">ERROR_REPORTING</span><span class="k">}</span>
date.timezone<span class="o">=</span><span class="k">${</span><span class="nv">DATE_TIMEZONE</span><span class="k">}</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>PHP-FPM can also be configured this way:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>pm <span class="o">=</span> <span class="k">${</span><span class="nv">FPM_PM</span><span class="k">}</span>
pm.max_children <span class="o">=</span> <span class="k">${</span><span class="nv">FPM_PM_MAX_CHILDREN</span><span class="k">}</span>
pm.start_servers <span class="o">=</span> <span class="k">${</span><span class="nv">FPM_PM_START_SERVICE</span><span class="k">}</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>Since we can pass environment variable values when spinning up a Docker container, this can be combined to remove the need for maintaining a separate php.ini file in your project’s repo!</p> <h3 id="caveats">Caveats</h3> <p>A few things to keep in mind:</p> <ul> <li>You need to be explicit about which settings you want to allow env vars for. This means you can only use env vars if you have set the INI value to read from an env var (<code class="language-plaintext highlighter-rouge">display_errors=${DISPLAY_ERRORS}</code>)!</li> <li>If an env var is not set, the value will be empty. This means you must either set a default value when creating the initial INI file (not always desired), or the INI value must allow empty values.</li> <li>Bash has a default value fallback when working with variables. It looks like <code class="language-plaintext highlighter-rouge">FOO=${BAR:-"default value"}</code>. While this would have been great for our use case, INI files are <em>not</em> processed as Bash and thus the default value trick does not work here.</li> </ul> <p>The first point means you cannot use just any Docker image, it must have been built with env vars in mind from the start. A quick search on the Docker Hub does not bring up many results for this - just about all major PHP Docker images require managing the PHP INI file directly.</p> <p>The second point hurts us a little bit because some INI settings simply cannot have empty values. For example, you cannot have an <code class="language-plaintext highlighter-rouge">extension=</code>. PHP will complain.</p> <p>In FPM if you have <code class="language-plaintext highlighter-rouge">slowlog=</code> FPM will crash immediately. Unfortunately some INI settings are not amenable to env vars unless you enforce a value for them.</p> <p>The final point is a minor inconvenience. You cannot define a setting with an inline env var in the same line. You have to do this process separately.</p> <p>This means you cannot simply have your INI file look like:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nv">display_errors</span><span class="o">=</span><span class="k">${</span><span class="nv">DISPLAY_ERRORS</span><span class="k">:-</span><span class="s2">"Off"</span><span class="k">}</span>
<span class="nv">error_reporting</span><span class="o">=</span><span class="k">${</span><span class="nv">ERROR_REPORTING</span><span class="k">:-</span><span class="nv">0</span><span class="k">}</span>
date.timezone<span class="o">=</span><span class="k">${</span><span class="nv">DATE_TIMEZONE</span><span class="k">:-</span><span class="s2">"UTC"</span><span class="k">}</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>This would have been great but since it is strictly a Bashism it does not work within the PHP INI parser.</p> <p>This forces you to keep a separate list of env vars and their values, and a separate list of INI settings calling the env vars.</p> <p>We will go through these points in more detail later on.</p> <h2 id="building-docker-image-with-env-vars">Building Docker Image with Env Vars</h2> <p>Adding an env var to a Docker image within a Dockerfile is simple enough:</p> <div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> ubuntu:18.04</span>

<span class="k">ENV</span><span class="s"> allow_url_fopen=1</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>Now all containers that use this image and all images that extend this image, would have the env var <code class="language-plaintext highlighter-rouge">allow_url_fopen</code> available to them.</p> <p>To change this value when spinning up a container you would simply do</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>docker container run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="se">\</span>
    <span class="nt">-e</span> <span class="nv">allow_url_fopen</span><span class="o">=</span>0 <span class="se">\</span>
    <span class="o">{</span>image_name<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>and in the php.ini using</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="py">allow_url_fopen</span><span class="p">=</span><span class="s">${allow_url_fopen}</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>would allow us to change the setting on the fly without having to further edit a static INI file.</p> <p>My end goal was not to have just one or two settings available for changing, I want developers to take my images and plug them into their projects and configure as much as possible only through env vars. This means I needed to add as many INI settings as I can.</p> <p>This leads to a problem. Dockerfile cannot read and grab env vars from a separate file. <em>You have to define all env vars in the Dockerfile</em> to be able to use them in child images or containers.</p> <p>In a docker-compose file you can simply use <code class="language-plaintext highlighter-rouge">env_file</code> like so:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="na">services</span><span class="pi">:</span>
  <span class="na">my_special_service</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">something</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">env-file.env</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>If you are spinning up a container from an existing image you can likewise do</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>docker container run <span class="se">\</span>
    <span class="nt">--env-file</span><span class="o">=</span><span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>/env-file.env <span class="se">\</span>
    <span class="o">[</span>..]
</pre></td></tr></tbody></table></code></pre></div></div> <p>However, you cannot do the same when <em>building</em> a new image. There is no <code class="language-plaintext highlighter-rouge">ENV_FILE</code> in a Dockerfile - you have to list each env var one by one!</p> <p>The problem is more obvious when I tell you I identified over 650 PHP INI settings I wanted to set as env vars. Then realize I want to support all active versions of PHP (5.6, 7.0, 7.1, 7.2, 7.3) and that means each of the four Dockerfiles now need to have 650+ lines just for the env vars.</p> <p>If Dockerfile supports an <code class="language-plaintext highlighter-rouge">ENV_VAR</code> directive this would be a single-line solution. Since it does not, I needed to come up with some other way to add these hundreds of env vars, without junking up my Dockerfiles.</p> <h3 id="create-a-parent-image">Create a Parent Image</h3> <p>The solution turned out to be quite simple! Since each Dockerfile extends a parent image (via <code class="language-plaintext highlighter-rouge">FROM</code>), and everything available to that base image is available to the current Dockerfile, I created a Dockerfile that does nothing but define all the INI env vars my PHP images will be able to use.</p> <p><a href="https://github.com/jtreminio/php-docker/blob/master/Dockerfile-env">You can see it here.</a></p> <p>For settings that have no default value, and can remain blank, I did</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="py">PHP.allow_url_include</span><span class="p">=</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>For settings that ship with default values, I did</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="py">PHP.allow_url_fopen</span><span class="p">=</span><span class="s">1</span>
</pre></td></tr></tbody></table></code></pre></div></div> <blockquote class="info"> <p>Notice that I namespaced all my variables. The actual variable name is <code class="language-plaintext highlighter-rouge">PHP.allow_url_fopen</code> and so the INI file must reference this as <code class="language-plaintext highlighter-rouge">allow_url_fopen=${PHP.allow_url_fopen}</code>. This simply helps avoid naming collisions. You might also know that in Bash all variable names must only contain alphanumeric or <code class="language-plaintext highlighter-rouge">_</code> characters. The <code class="language-plaintext highlighter-rouge">.</code> in <code class="language-plaintext highlighter-rouge">PHP.allow_url_fopen</code> makes this an invalid variable name in Bash.</p> <p>Thankfully we are not reading these values in Bash, we are reading them in a PHP INI/FPM config file so the variable names are perfectly valid.</p> </blockquote> <h3 id="child-images">Child Images</h3> <p>Now that I have created an image that defines all the INI settings I want to expose to env vars, I can create child images that can reference the env vars in their php.ini files!</p> <p><a href="https://github.com/jtreminio/php-docker/blob/master/files/php.ini">You can see the INI file that all my images inject here.</a></p> <p>Any image that extends the previous image can use the defined env vars.</p> <p>The following slice of php.ini:</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="py">allow_url_fopen</span> <span class="p">=</span> <span class="s">${PHP.allow_url_fopen}</span>
<span class="py">allow_url_include</span> <span class="p">=</span> <span class="s">${PHP.allow_url_include}</span>
<span class="py">always_populate_raw_post_data</span> <span class="p">=</span> <span class="s">${PHP.always_populate_raw_post_data}</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>is read as the following by the PHP engine:</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="py">allow_url_fopen</span> <span class="p">=</span> <span class="s">1</span>
<span class="py">allow_url_include</span> <span class="p">=</span>
<span class="py">always_populate_raw_post_data</span> <span class="p">=</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>Blank values are perfectly acceptable for these settings.</p> <p>Likewise, in <a href="https://github.com/jtreminio/php-docker/blob/master/files/fpm.conf">the PHP-FPM config file</a> we have:</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="py">pm</span> <span class="p">=</span> <span class="s">${FPM.pm}</span>
<span class="py">pm.max_children</span> <span class="p">=</span> <span class="s">${FPM.pm.max_children}</span>
<span class="py">pm.start_servers</span> <span class="p">=</span> <span class="s">${FPM.pm.start_servers}</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>which is read as</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="py">pm</span> <span class="p">=</span> <span class="s">dynamic</span>
<span class="py">pm.max_children</span> <span class="p">=</span> <span class="s">5</span>
<span class="py">pm.start_servers</span> <span class="p">=</span> <span class="s">2</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>I deliberately chose not to add all possible settings. Like I mentioned earlier, FPM’s <code class="language-plaintext highlighter-rouge">slowlog</code> setting <em>must</em> have a value. If it is blank FPM immediately dies with a segfault. Settings like this where developers may not always want to have but cannot leave blank are not friendly to the env var method.</p> <h2 id="removing-cmd-from-dockerfile">Removing CMD from Dockerfile</h2> <p>One thing I ran into was that the service defined via Dockerfile’s <code class="language-plaintext highlighter-rouge">CMD</code> will not receive updated env var values!</p> <p>For example, in my <a href="https://github.com/jtreminio/php-docker/commit/05c6a32e023e4095081620a6493c6da4a2823ce5">PHP images I would have PHP-FPM service handled via <code class="language-plaintext highlighter-rouge">CMD</code></a> and this service would pick up env var values as set at that point. If the Dockerfile had <code class="language-plaintext highlighter-rouge">ENV FPM.pm=dynamic</code> that is what the <code class="language-plaintext highlighter-rouge">CMD</code> service would use, even if you later changed the env var value.</p> <p>The list of possible solutions included having the <code class="language-plaintext highlighter-rouge">CMD</code> reload the current env vars, or starting a new session, or any number of hacky things just to get around this limitation.</p> <p>What I ended up doing was simply removing <code class="language-plaintext highlighter-rouge">CMD</code> from my Dockerfiles. Now the PHP images are truly open between being used for CLI or FPM! You simply call the PHP-FPM service when spinning up the container.</p> <h2 id="how-to-use-the-images">How to Use the Images</h2> <p>It is simple enough to use these images.</p> <p>For the default INI values:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>docker container run <span class="nt">--rm</span> <span class="se">\</span>
    jtreminio/php:7.2 php <span class="nt">-i</span> | <span class="nb">grep </span>error_reporting
195:error_reporting <span class="o">=&gt;</span> 0 <span class="o">=&gt;</span> 0
</pre></td></tr></tbody></table></code></pre></div></div> <p>To override the defaults:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>docker container run <span class="nt">--rm</span> <span class="se">\</span>
    <span class="nt">-e</span> PHP.error_reporting<span class="o">=</span><span class="nt">-1</span> <span class="se">\</span>
    jtreminio/php:7.2 php <span class="nt">-i</span> | <span class="nb">grep </span>error_reporting
195:error_reporting <span class="o">=&gt;</span> <span class="nt">-1</span> <span class="o">=&gt;</span> <span class="nt">-1</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>You can just as easily override multiple settings:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>docker container run <span class="nt">--rm</span> <span class="se">\</span>
    <span class="nt">-e</span> PHP.error_reporting<span class="o">=</span><span class="nt">-1</span> <span class="se">\</span>
    <span class="nt">-e</span> PHP.display_errors<span class="o">=</span>On <span class="se">\</span>
    <span class="nt">-e</span> <span class="s2">"PHP.date.timezone=America/Chicago"</span> <span class="se">\</span>
    jtreminio/php:7.2 php <span class="nt">-i</span> | <span class="se">\</span>
        egrep <span class="s1">'error_reporting|display_errors|date.timezone'</span>
display_errors <span class="o">=&gt;</span> STDOUT <span class="o">=&gt;</span> STDOUT
error_reporting <span class="o">=&gt;</span> <span class="nt">-1</span> <span class="o">=&gt;</span> <span class="nt">-1</span>
date.timezone <span class="o">=&gt;</span> America/Chicago <span class="o">=&gt;</span> America/Chicago
</pre></td></tr></tbody></table></code></pre></div></div> <p>To run PHP-FPM you just call the service:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>docker container run <span class="nt">--rm</span> <span class="se">\</span>
    <span class="nt">-e</span> PHP.error_reporting<span class="o">=</span><span class="nt">-1</span> <span class="se">\</span>
    <span class="nt">-e</span> PHP.display_errors<span class="o">=</span>On <span class="se">\</span>
    <span class="nt">-e</span> <span class="s2">"PHP.date.timezone=America/Chicago"</span> <span class="se">\</span>
    jtreminio/php:7.2 /usr/bin/php-fpm
<span class="o">[</span>15-Nov-2018 23:32:39] NOTICE: fpm is running, pid 9
<span class="o">[</span>15-Nov-2018 23:32:39] NOTICE: ready to handle connections
<span class="o">[</span>15-Nov-2018 23:32:39] NOTICE: systemd monitor interval <span class="nb">set </span>to 10000ms
</pre></td></tr></tbody></table></code></pre></div></div> <p>You can test if PHP-FPM is reading env vars as well by doing:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>docker container run <span class="nt">--rm</span> <span class="se">\</span>
  <span class="nt">-e</span> PHP.error_reporting<span class="o">=</span><span class="nt">-1</span> <span class="se">\</span>
  <span class="nt">-e</span> PHP.display_errors<span class="o">=</span>On <span class="se">\</span>
  <span class="nt">-e</span> <span class="s2">"PHP.date.timezone=America/Chicago"</span> <span class="se">\</span>
  <span class="nt">-e</span> FPM.pm<span class="o">=</span>foobar <span class="se">\</span>
  jtreminio/php:7.2 /usr/bin/php-fpm
<span class="o">[</span>15-Nov-2018 23:33:08] ERROR: <span class="o">[</span>/etc/php/7.2/fpm/php-fpm.conf:14] unable to parse value <span class="k">for </span>entry <span class="s1">'pm'</span>: invalid process manager <span class="o">(</span>static, dynamic or ondemand<span class="o">)</span>
<span class="o">[</span>15-Nov-2018 23:33:08] ERROR: failed to load configuration file <span class="s1">'/etc/php/7.2/fpm/php-fpm.conf'</span>
<span class="o">[</span>15-Nov-2018 23:33:08] ERROR: FPM initialization failed
</pre></td></tr></tbody></table></code></pre></div></div> <h2 id="wrapping-it-up">Wrapping It Up</h2> <p>Not all services are amenable to configuration by environment variables, which is a shame. Tools like Nginx require special modules (Lua) for this functionality.</p> <p>The PHP core team was forward-thinking enough to have added support for env vars long ago, and we get to enjoy its benefits.</p> <p>Some future nice-to-haves would include default values, but for now this works pretty well.</p> <p>Having to manage less files to run your Docker containers is a win in my book.</p> <p>If you see some INI settings that you think should be included, <a href="https://github.com/jtreminio/php-docker">please submit a PR to the repo</a>.</p> <p>Until next time, this is Señor PHP Developer Juan Treminio wishing you adios!</p> <hr class="invisible"> <ul class="pager"> <li class="previous"> <a href="/blog/setting-up-a-static-site-with-hugo-and-push-to-deploy" data-toggle="tooltip" data-placement="top" title="Setting Up a Static Site with Hugo and Push to Deploy"> Previous &rarr;<br> <span>Setting Up a Static Site with Hugo and Push to Deploy</span> </a> </li> <li class="next"> <a href="/blog/php-modules-toggled-via-environment-variables" data-toggle="tooltip" data-placement="top" title="PHP Modules Toggled via Environment Variables"> &larr; Next<br> <span>PHP Modules Toggled via Environment Variables</span> </a> </li> </ul> <hr class="invisible"> </div> </div> </div> </article> <footer> <div class="container"> <div class="row"> <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"> <ul class="list-inline text-center footer-icons"> <li><a href="mailto:jtreminio@gmail.com"><i data-feather="mail"></i></a></li> <li> <a href="https://github.com/jtreminio" target="_blank"> <i data-feather="github"></i> </a> </li> <li> <a href="https://twitter.com/juantreminio" target="_blank"> <i data-feather="twitter"></i> </a> </li> <li> <a href="https://www.linkedin.com/in/jtreminio-1" target="_blank"> <i data-feather="linkedin"></i> </a> </li> </ul> </div> </div> </div> </footer> <link href="//cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" rel="stylesheet" type="text/css"/> <link href="//cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" rel="stylesheet" type="text/css"/> <script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js"></script> <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"> <div class="pswp__bg"></div> <div class="pswp__scroll-wrap"> <div class="pswp__container"> <div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div> </div> <div class="pswp__ui pswp__ui--hidden"> <div class="pswp__top-bar"> <div class="pswp__counter"></div> <button class="pswp__button pswp__button--close" title="Close (Esc)"></button> <button class="pswp__button pswp__button--share" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button> <div class="pswp__preloader"> <div class="pswp__preloader__icn"> <div class="pswp__preloader__cut"> <div class="pswp__preloader__donut"></div> </div> </div> </div> </div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"> <div class="pswp__share-tooltip"></div> </div> <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"> </button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"> </button> <div class="pswp__caption"> <div class="pswp__caption__center"></div> </div> </div> </div> </div> </body> <script src="/static/js/custom.js?1642996622"></script> </html>