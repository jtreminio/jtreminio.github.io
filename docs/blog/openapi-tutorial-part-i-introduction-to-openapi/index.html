<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"> <meta name="description" content="Juan Treminio - Dallas based senior web developer"> <meta name="keywords" content=""> <meta property="og:title" content="OpenAPI Tutorial Part I: Introduction to OpenAPI - Juan Treminio - Senior Web Developer Blog"> <meta property="og:type" content="article"> <meta property="og:description" content="Stop me if one of these scenarios sounds familiar: "> <meta property="article:tag" content="openapi"> <meta property="article:tag" content="webdev"> <meta property="article:tag" content="tutorial"> <meta property="article:tag" content="swagger"> <meta property="og:url" content="https://jtreminio.com/blog/openapi-tutorial-part-i-introduction-to-openapi/"> <meta property="og:site_name" content="Juan Treminio - Senior Web Developer Blog"> <title>OpenAPI Tutorial Part I: Introduction to OpenAPI - Juan Treminio - Senior Web Developer Blog</title> <link rel="shortcut icon" type="image/png" href="/static/favicon/favicon.ico"/> <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png"> <link rel="shortcut icon" type="image/png" href="/static/favicon/favicon-96x96.png" sizes="96x96"/> <link rel="shortcut icon" type="image/png" href="/static/favicon/favicon-32x32.png" sizes="32x32"/> <link rel="shortcut icon" type="image/png" href="/static/favicon/favicon-16x16.png" sizes="16x16"/> <link rel="canonical" href="https://jtreminio.com/blog/openapi-tutorial-part-i-introduction-to-openapi/"> <link href="//cdn.jsdelivr.net/npm/bootstrap-no-fonts-no-js@3.3.7/css/bootstrap.min.css" rel="stylesheet" type="text/css"/> <link href="//cdnjs.cloudflare.com/ajax/libs/startbootstrap-clean-blog/3.3.7/css/clean-blog.min.css" rel="stylesheet" type="text/css"/> <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"/> <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"/> <script src="//cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script> <link rel="stylesheet" href="/static/css/rouge.css"/> <link rel="stylesheet" href="/static/css/custom.css?1643642128"/> <link rel="stylesheet" href="/static/css/dark.css?1643642128" data-dark-style/> </head> <body> <nav class="navbar navbar-default navbar-expand-md navbar-custom navbar-fixed-top is-fixed is-visible"> <div class="container-fluid"> <div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand hidden-xs hidden-sm" href="/">Juan Treminio - Senior Web Developer Blog</a> <a class="navbar-brand visible-xs visible-sm" href="/">Juan Treminio - Developer Blog</a> </div> <div class="collapse navbar-collapse" id="main-navbar-collapse"> <ul class="nav navbar-nav navbar-right"> <li><a href="/">Blog</a></li> <li><a href="/about/">About</a></li> <li><a href="/hire-me/">Hire Me</a></li> <li> <a class="btn theme-toggle"> <span class="theme-dark"><i data-feather="moon"></i> Dark Theme</span> <span class="theme-light"><i data-feather="sun"></i> Light Theme</span> </a> </li> </ul> </div> </div> </nav> <header class="intro-header"> <div class="container"> <div class="row"> <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"> <div class="post-heading"> <h1>OpenAPI Tutorial Part I: Introduction to OpenAPI</h1> <h2 class="subheading">Wait, Don't You Mean Swagger?</h2> <div class="meta">Posted on Jan 31, 2022 <br/> <span> <i data-feather="tag" alt="tags"></i> <a href="/tags#openapi">openapi</a>, <a href="/tags#webdev">webdev</a>, <a href="/tags#tutorial">tutorial</a>, <a href="/tags#swagger">swagger</a> </span> </div> </div> </div> </div> </div> </header> <article> <div class="container"> <div class="row"> <div class="post col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"> <p>Stop me if one of these scenarios sounds familiar:</p> <ul> <li>You have a public API but no SDKS. You expect your clients to use cURL to use your API.</li> <li>You have an internal API, but no documentation. Your team‚Äôs engineers add functionality to endpoints willy-nilly and now it is hard to keep track of what parameters, and the types of each parameter, each endpoint expects.</li> <li>You have a product, but no API. You have no idea how to even create an API, documentation, or examples. How do I even REST?</li> <li>You have a mature public API and SDKs across several different languages. <ul> <li>Nancy, who maintained the <strong>Ruby SDK</strong>, left 2 years ago and no one else on your team knows how to code in Ruby so it is far behind the Python SDK.</li> <li>Joe maintains the <strong>Python SDK</strong>, but he is lazy and slow and does not add new features in a timely manner. The Python SDK has some features the Ruby SDK is missing but has not been updated in several months and now customers are opening GitHub issues demanding an update to at least apply a security patch to some random library it uses.</li> <li>Your team is mostly a PHP team so the <strong>PHP SDK</strong> is kind of, more or less, almost, but not quite, on par with the actual API implementation. cURL will always have access to all the latest API endpoints and parameters. Why can‚Äôt your customers just use cURL?</li> <li>LOL there is no <strong>Java or .Net SDK</strong>. We‚Äôre a web development company, not a Windows shop!</li> </ul> </li> </ul> <p>You can use OpenAPI to drastically reduce, and sometimes completely eliminate, the workload required for creating, maintaining, and updating your API definition, keeping public documentation on-par with your internal API representation, and generating, maintaining, and updating your SDKs.</p> <p>From a single YAML (or JSON) file you can define cURL examples, callback events, OAuth, and so much more. To be clear, while most of the work required to get these benefits will be done for you once you have your OpenAPI definitions file ready, some (especially SDK generation) will still require fine-tuning to both get around bugs in the tooling and to fit your specific use-case.</p> <h2 id="openapi-i-thought-it-was-swagger">OpenAPI? I Thought It Was Swagger?</h2> <p>Swagger‚Äôs initial release was in 2011. The company that invented Swagger was eventually purchased by <a href="https://smartbear.com/">SmartBear Software</a>. In 2016 the Swagger specification was renamed to OpenAPI Specification.</p> <p>Now, ‚ÄúSwagger‚Äù refers to the tools offered by the SmartBear Software company, including:</p> <ul> <li><a href="https://swagger.io/swagger-editor/">Swagger Editor</a></li> <li><a href="https://swagger.io/swagger-ui/">Swagger UI</a></li> <li><a href="https://swagger.io/swagger-codegen/">Swagger Codegen</a></li> </ul> <p>They offer several more tools, and if you want to read much more details on the differences and products offered by Swagger, read their <a href="https://swagger.io/blog/api-strategy/difference-between-swagger-and-openapi/">What Is the Difference Between Swagger and OpenAPI?</a> page.</p> <p>‚ÄúOpenAPI‚Äù refers only to the actual specification. In other words, OpenAPI is what is <a href="https://github.com/OAI/OpenAPI-Specification/tree/main/versions">defined in these files</a>.</p> <p>I will refer back to Swagger‚Äôs tools only when comparing them to other tools that, in my opinion, offer more robust support for the latest OpenAPI features.</p> <p>The distinction here is important. Swagger is a group of tools, but OpenAPI is just a spec. By itself, OpenAPI does not actually <em>do</em> anything. For that, we must rely on the overall ecosystem built around the spec. This will become clearer as you read along.</p> <h2 id="what-can-i-do-with-openapi">What Can I Do With OpenAPI?</h2> <p>At the risk of being too simplistic and getting corrected by internet nerds the world over, the OpenAPI Spec (OAS) allows you to define a RESTful API in a YAML or JSON file(s), which we will call your definitions file(s).</p> <p>You can:</p> <ul> <li>define endpoints (<code class="language-plaintext highlighter-rouge">POST /account/create</code>)</li> <li>what parameters the endpoints will accept (maybe the <code class="language-plaintext highlighter-rouge">POST /account/create</code> endpoint expects an <code class="language-plaintext highlighter-rouge">email_address</code>)</li> <li>responses from the API to the requester in the form of <ul> <li>HTTP codes (<code class="language-plaintext highlighter-rouge">HTTP 200 OK</code>)</li> <li>or full JSON responses</li> </ul> </li> <li>authorization, like Basic Auth, API keys, OAuth2, etc</li> </ul> <p>There are a few more main points in the OAS and we will get to them in due time. The above all exist in your definitions file, but it is just a static text file. The file itself just implements the rules from the OAS. It is once you have your spec file that you can begin playing around with the tooling that has evolved alongside the OAS.</p> <p>All of the following tools do their work from your definitions file, <em>that</em> is where the magic of OpenAPI begins to shine.</p> <h3 id="documentation">Documentation</h3> <p>Several tools exist that read your definitions file and generate beautiful documentation for end-users to read.</p> <p>The documentation generated can look different based on which generator you use. For example, some will create beautiful HTML pages you can open in your browser. Others can spit out Markdown (or other) files.</p> <p>There are a number of <a href="https://nordicapis.com/7-open-source-openapi-documentation-generators/">products that you can read about here</a>. Some are open-sourced, others are paid. Each one generates pages that look different from the others, and each one implements the OAS differently as well!</p> <h3 id="sdk-generation">SDK Generation</h3> <p>You can generate SDKs for end-users in a number of different languages. There are two major open-sourced generators:</p> <ul> <li><a href="https://github.com/OpenAPITools/openapi-generator">openapi-generator</a></li> <li><a href="https://github.com/swagger-api/swagger-codegen">swagger-codegen</a></li> </ul> <p>Additionally, I know of one major commercial product called <a href="https://www.apimatic.io/">APIMatic</a> that can generate SDKs, documentation, and several others things. They might be a good option if you want a third-party company to handle almost everything OpenAPI-related for you, but are somewhat expensive.</p> <h2 id="before-getting-started-tools-to-use">Before Getting Started, Tools to Use</h2> <p>The OpenAPI tool ecosystem is large and fast paced. Because the OAS is just a file that does not do anything by itself, figuring out all the different possibilities and deciding which tools to use can be daunting.</p> <p>Rather than showing your OpenAPI definitions code and letting you figure out what to do with it, I figure it is easier to recommend some tools you can install on your machine before we dive in.</p> <h3 id="generating-your-definitions-file">Generating Your Definitions File</h3> <p>You can write your definitions file by hand but I have found that to be cumbersome and slow. While the OAS allows reusing definitions so you do not have to copy/paste the same things over and over, it is fairly limited.</p> <p>For generating your definitions file I recommend using an annotations-based tool. While this series can be considered language-agnostic, meaning whether you are strongest in PHP, Javascript, Ruby, etc, I will use a PHP-based tool called <a href="http://zircote.github.io/swagger-php/">zircote/swagger-php</a> to help generate the OpenAPI definitions file from PHP annotations.</p> <p>There are a number of similar projects for other languages, and the information in this series should translate easily! Here are a few:</p> <ul> <li>PHP - <a href="http://zircote.github.io/swagger-php/">zircote/swagger-php</a></li> <li>Typescript - <a href="https://github.com/lukeautry/tsoa">tsoa</a></li> <li>Python - <a href="https://github.com/axnsan12/drf-yasg">drf-yasg</a></li> <li>Ruby - <a href="https://github.com/solso/source2swagger">source2swagger</a></li> <li><a href="https://swagger.io/blog/api-development/swagger-annotation-libraries/">See more languages</a></li> </ul> <p>These types of annotations-based tools offer several benefits over manually maintaining your definitions file:</p> <ul> <li>They are based on your language of choice and allow you to use language features like constants, greatly reducing the need to copy/paste data where the OAS‚Äô reusability falls short.</li> <li>Annotations can be placed alongside the code they are tied to. If you have a class that lists all properties an endpoint expects you can add property annotations in the same place. This makes maintaining your actual implementation with your OpenAPI definitions much simpler.</li> <li>Your IDE may assist you with auto-complete</li> </ul> <p>To help reduce language barriers I will first show code using the <code class="language-plaintext highlighter-rouge">zircote/swagger-php</code> annotations and then show the result of generating the definitions so you can compare between your results and mine.</p> <p>You can install <code class="language-plaintext highlighter-rouge">zircote/swagger-php</code> via composer with <code class="language-plaintext highlighter-rouge">composer require zircote/swagger-php</code>. I will provide setup instructions later on.</p> <p>If you are not using PHP please follow the instructions for your specific tool.</p> <h3 id="generating-documentation">Generating Documentation</h3> <p>For documentation generation I highly recommend using <a href="https://redoc.ly/docs/redoc/quickstart/cli/">redoc-cli</a>. It is a CLI-based tool that reads your definitions file and starts a server on your local machine, using Redoc.</p> <p><a href="https://github.com/Redocly/redoc">Redoc is a free, MIT-licensed tool</a>, and the company that created it also offers a <a href="https://redoc.ly/reference-docs">paid, commercial product called Redocly</a>.</p> <p>I am not receiving any kickbacks for recommending Redoc, I simply have tested a complex definitions file and found that Redoc is the only one that supports all of the OAS 3.0‚Äôs features. As we come across those specific features in this tutorial series I will point them out.</p> <p>Install <code class="language-plaintext highlighter-rouge">redoc-cli</code> by <a href="https://redoc.ly/docs/redoc/quickstart/cli/">following the instructions in their quickstart guide</a>.</p> <p>You can install it globally by running <code class="language-plaintext highlighter-rouge">npm i -g redoc-cli</code>.</p> <h3 id="sdk-generation-1">SDK Generation</h3> <p>For SDK generation, stick with <a href="https://github.com/OpenAPITools/openapi-generator">openapi-generator</a>. It has a large, active community and the <a href="https://openapi-generator.tech/docs/generators/">number of languages it supports</a> is quite impressive.</p> <p>After extensive testing I have found <code class="language-plaintext highlighter-rouge">openapi-generator</code> to be the least buggy and most feature-complete. <em>That said</em>, each language that <code class="language-plaintext highlighter-rouge">openapi-generator</code> supports is maintained by separate contributors, so code quality, features, and usability will vary greatly between them!</p> <p><a href="https://openapi-generator.tech/docs/installation/">Follow their instructions to install</a>.</p> <p>If you are on MacOS I highly recommend installing via Homebrew: <code class="language-plaintext highlighter-rouge">brew install openapi-generator</code>.</p> <p>If you are on Linux (or have Docker installed on Windows), use Docker.</p> <p><code class="language-plaintext highlighter-rouge">openapi-generator</code> is a Java application and its dependencies might be a bit frustrating to setup.</p> <h3 id="choosing-an-api-to-implement">Choosing an API to Implement</h3> <p>For this tutorial series we will implement the <a href="https://petstore.swagger.io/#/">Pet Store API</a> from the ground up. Doing so will help make it clear how all the separate pieces fit together to create the final product. I will try to make the process mimic how a company with an existing, manually-maintained API would implement OpenAPI.</p> <p>Additionally, we will extend this API to include some more advanced features available in OAS 3.x. Not all APIs are as simple as the default Pet Store example, so I am hoping this will turn out to be a good learning experience.</p> <p>Even though the Pet Store API is already written in OpenAPI, simply having the final product immediately available is not so great for figuring out how to go from zero to final product.</p> <h2 id="initial-setup">Initial Setup</h2> <p>Assuming you have already installed the tools from above we can now create the scripts to call these tools. First, our project‚Äôs basic directory structure.</p> <h3 id="organizing-our-code">Organizing Our Code</h3> <p>We will create a directory to contain our executables so we do not have to memorize the commands for regenerating the definitions file, starting the documentation server, and (eventually) creating our SDKs. This will be the <code class="language-plaintext highlighter-rouge">bin</code> directory.</p> <p>OpenAPI does not have the concept of namespaces. We are going to create classes to handle requests (user sending data to our API) and responses (our API sending data back to the user). These will be in <code class="language-plaintext highlighter-rouge">Request</code> and <code class="language-plaintext highlighter-rouge">Response</code> namespaces, respectively, and live within the <code class="language-plaintext highlighter-rouge">src</code> directory.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> ./bin ./src/Request ./src/Response

<span class="nv">$ </span>tree
<span class="nb">.</span>
‚îú‚îÄ‚îÄ bin
‚îÇ   ‚îî‚îÄ‚îÄ // ... empty
‚îî‚îÄ‚îÄ src
    ‚îú‚îÄ‚îÄ Request
    ‚îÇ   ‚îî‚îÄ‚îÄ // ... empty
    ‚îî‚îÄ‚îÄ Response
        ‚îî‚îÄ‚îÄ // ... empty

</pre></td></tr></tbody></table></code></pre></div></div> <h3 id="setting-up-zircoteswagger-php">Setting Up <code class="language-plaintext highlighter-rouge">zircote/swagger-php</code></h3> <p>Install it with composer:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>composer require zircote/swagger-php

Using version ^4.2 <span class="k">for </span>zircote/swagger-php
./composer.json has been created
Running composer update zircote/swagger-php
Loading composer repositories with package information

<span class="c"># ... snip</span>

Package operations: 10 installs, 0 updates, 0 removals
  - Installing symfony/yaml <span class="o">(</span>v5.4.3<span class="o">)</span>: Extracting archive
  - Installing zircote/swagger-php <span class="o">(</span>4.2.4<span class="o">)</span>: Extracting archive
1 package suggestions were added by new dependencies, use <span class="sb">`</span>composer suggest<span class="sb">`</span> to see details.
Generating autoload files

</pre></td></tr></tbody></table></code></pre></div></div> <p>Create a file at <code class="language-plaintext highlighter-rouge">./bin/generate.php</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>#!/usr/bin/env php
<span class="cp">&lt;?php</span>

<span class="k">require_once</span> <span class="k">__DIR__</span><span class="mf">.</span><span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">OpenApi\Generator</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Symfony\Component\Yaml\Yaml</span><span class="p">;</span>

<span class="nv">$openapi</span> <span class="o">=</span> <span class="nc">Generator</span><span class="o">::</span><span class="nf">scan</span><span class="p">([</span><span class="k">__DIR__</span><span class="mf">.</span><span class="s1">'/../src'</span><span class="p">]);</span>
<span class="nv">$yaml</span> <span class="o">=</span> <span class="nv">$openapi</span><span class="o">-&gt;</span><span class="nf">toYaml</span><span class="p">(</span>
    <span class="nc">Yaml</span><span class="o">::</span><span class="no">DUMP_OBJECT_AS_MAP</span>
    <span class="o">^</span> <span class="nc">Yaml</span><span class="o">::</span><span class="no">DUMP_EMPTY_ARRAY_AS_SEQUENCE</span>
    <span class="o">^</span> <span class="nc">Yaml</span><span class="o">::</span><span class="no">DUMP_MULTI_LINE_LITERAL_BLOCK</span>
<span class="p">);</span>

<span class="nv">$oas_file</span> <span class="o">=</span> <span class="k">__DIR__</span><span class="mf">.</span><span class="s1">'/../openapi.yaml'</span><span class="p">;</span>
<span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$oas_file</span><span class="p">,</span> <span class="nv">$yaml</span><span class="p">);</span>
<span class="k">echo</span> <span class="s2">"Wrote OAS file to </span><span class="si">{</span><span class="nv">$oas_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

</pre></td></tr></tbody></table></code></pre></div></div> <p>You can make it executable with <code class="language-plaintext highlighter-rouge">chmod +x ./bin/generate.php</code> or run it directly with php.</p> <p>All we have done here is told <code class="language-plaintext highlighter-rouge">zircote/swagger-php</code> (namespaced as <code class="language-plaintext highlighter-rouge">OpenApi</code>) to scan the <code class="language-plaintext highlighter-rouge">./src</code> directory for its annotations, then write the generated definitions to the <code class="language-plaintext highlighter-rouge">./openapi.yaml</code> file.</p> <p>Whenever we make a change to our OpenAPI annotations we can run this script to regenerate our definitions file.</p> <h3 id="setting-up-redoc-cli">Setting Up <code class="language-plaintext highlighter-rouge">redoc-cli</code></h3> <p>Create a file at <code class="language-plaintext highlighter-rouge">./bin/docs.sh</code>:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c">#!/usr/bin/env bash</span>

<span class="nb">set</span> <span class="nt">-e</span>
<span class="nv">DIR</span><span class="o">=</span><span class="si">$(</span><span class="nb">cd</span> <span class="sb">`</span><span class="nb">dirname</span> <span class="nv">$0</span><span class="sb">`</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span><span class="si">)</span>

redoc-cli serve <span class="se">\</span>
  <span class="s2">"</span><span class="k">${</span><span class="nv">DIR</span><span class="k">}</span><span class="s2">/../openapi.yaml"</span> <span class="se">\</span>
  <span class="nt">--port</span><span class="o">=</span>8080 <span class="se">\</span>
  <span class="nt">--watch</span> <span class="se">\</span>
  <span class="nt">--options</span>.requiredPropsFirst<span class="o">=</span>1

</pre></td></tr></tbody></table></code></pre></div></div> <p>Make it executable with <code class="language-plaintext highlighter-rouge">chmod +x ./bin/docs.sh</code>.</p> <p>Once we create our initial definitions file we can run this script to keep Redoc open in a browser. Whenever we regenerate the definitions file refreshing the browser will show the latest changes.</p> <h3 id="create-openapi-entry-file">Create OpenApi Entry File</h3> <p>Before we can run the generator for the first time we need to create a file with the minimum annotations requirements. Create a <code class="language-plaintext highlighter-rouge">./src/OpenApi.php</code> file with the following contents:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>

<span class="k">declare</span><span class="p">(</span><span class="n">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="kn">namespace</span> <span class="nn">PetStoreApi</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">OpenApi\Annotations</span> <span class="k">as</span> <span class="no">OA</span><span class="p">;</span>

<span class="cd">/**
 * @OA\OpenApi(openapi="3.0.3")
 * @OA\Info(title="Pet Store Api",
 *     version="1.0.0",
 * )
 * @OA\Server(url="https://petstore.example.com/")
 */</span>
<span class="kd">class</span> <span class="nc">OpenApi</span>
<span class="p">{</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">@OA</code> annotations will be read by the <code class="language-plaintext highlighter-rouge">zircote/swagger-php</code> library when generating our definitions file.</p> <p>If you are following along in PHP you may want to read a little of the <a href="http://zircote.github.io/swagger-php/">zircote/swagger-php</a> documentation. If you are using another language, do the same with your tool!</p> <h4 id="initial-generation">Initial Generation</h4> <p>When you run the generator script it will create a file for you. Do not worry about warnings at this point, we will fill out the requirements in the next steps.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>php ./bin/generate.php

Warning: Required @OA<span class="se">\P</span>athItem<span class="o">()</span> not found <span class="k">in</span> ./vendor/zircote/swagger-php/src/Loggers/DefaultLogger.php on line 27
Wrote OAS file to ./bin/../openapi.yaml

</pre></td></tr></tbody></table></code></pre></div></div> <p>Take a look at the newly-created <code class="language-plaintext highlighter-rouge">./openapi.yaml</code> file. It should have the following contents:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="na">openapi</span><span class="pi">:</span> <span class="s">3.0.0</span>
<span class="na">info</span><span class="pi">:</span>
  <span class="na">title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Pet</span><span class="nv"> </span><span class="s">Store</span><span class="nv"> </span><span class="s">Api'</span>
  <span class="na">version</span><span class="pi">:</span> <span class="s">1.0.0</span>
<span class="na">servers</span><span class="pi">:</span>
  <span class="pi">-</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s1">'</span><span class="s">https://petstore.example.com/'</span>

</pre></td></tr></tbody></table></code></pre></div></div> <p>Now you can run the documentation script to get Redoc working!</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>./bin/docs.sh

Server started: http://127.0.0.1:8080
üëÄ  Watching ./ <span class="k">for </span>changes...

</pre></td></tr></tbody></table></code></pre></div></div> <p>Open <a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a> in your browser and you should see the Redoc documentation. It will be bare bones right now, but we will quickly start filling this in.</p> <h3 id="final-project-structure">Final Project Structure</h3> <p>As of now you should have a project structure that looks like this:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>tree <span class="nt">-a</span> <span class="nt">--filesfirst</span>
<span class="nb">.</span>
‚îú‚îÄ‚îÄ composer.json
‚îú‚îÄ‚îÄ composer.lock
‚îú‚îÄ‚îÄ openapi.yaml
‚îú‚îÄ‚îÄ bin
‚îÇ   ‚îú‚îÄ‚îÄ docs.sh
‚îÇ   ‚îî‚îÄ‚îÄ generate.php
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îú‚îÄ‚îÄ OpenApi.php
‚îÇ   ‚îú‚îÄ‚îÄ Request
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ // ... empty
‚îÇ   ‚îî‚îÄ‚îÄ Response
‚îÇ       ‚îî‚îÄ‚îÄ // ... empty
‚îî‚îÄ‚îÄ vendor
    ‚îú‚îÄ‚îÄ autoload.php
    ‚îú‚îÄ‚îÄ bin
    ‚îÇ   ‚îî‚îÄ‚îÄ openapi -&gt; ../zircote/swagger-php/bin/openapi
    ‚îî‚îÄ‚îÄ // ... snip

</pre></td></tr></tbody></table></code></pre></div></div> <h3 id="extra-credit">Extra Credit</h3> <p>We are going to be writing a lot of annotations, and sometimes an IDE may get confused with exactly how many spaces to indent multi-nested definitions.</p> <p>For example, the <code class="language-plaintext highlighter-rouge">info</code> block in your definitions file can contain much more information, like so:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="cd">/**
 * @OA\OpenApi(openapi="3.0.3")
 * @OA\Info(title="Pet Store Api",
 *     version="1.0.0",
 *     @OA\License(name="MIT",
 *          url="https://opensource.org/licenses/MIT"
 *      ),
 * )
 */</span>

</pre></td></tr></tbody></table></code></pre></div></div> <p>If you care about consistent spacing the above should look like this:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="cd">/**
 * @OA\OpenApi(openapi="3.0.3")
 * @OA\Info(title="Pet Store Api",
 *     version="1.0.0",
 *     @OA\License(name="MIT",
 *         url="https://opensource.org/licenses/MIT"
 *     ),
 * )
 */</span>

</pre></td></tr></tbody></table></code></pre></div></div> <p>It is a small thing, but once you get 4, 5 levels deep the small differences can get annoying.</p> <p>Let‚Äôs use <code class="language-plaintext highlighter-rouge">friendsofphp/php-cs-fixer</code> to automatically format our code every time we regenerate our definitions file:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>composer require <span class="nt">--dev</span> friendsofphp/php-cs-fixer

Using version ^3.4 <span class="k">for </span>friendsofphp/php-cs-fixer
./composer.json has been updated
<span class="c"># ... snip</span>
</pre></td></tr></tbody></table></code></pre></div></div> <p>Create a <code class="language-plaintext highlighter-rouge">./.php-cs-fixer.php</code> file to contain the configuration options:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>

<span class="nv">$finder</span> <span class="o">=</span> <span class="nc">PhpCsFixer\Finder</span><span class="o">::</span><span class="nf">create</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="nf">in</span><span class="p">(</span><span class="k">__DIR__</span><span class="mf">.</span><span class="s1">'/src'</span><span class="p">);</span>

<span class="nv">$config</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PhpCsFixer\Config</span><span class="p">();</span>
<span class="k">return</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="nf">setRules</span><span class="p">([</span>
    <span class="s1">'@DoctrineAnnotation'</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s1">'@Symfony'</span>            <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">])</span>
    <span class="o">-&gt;</span><span class="nf">setFinder</span><span class="p">(</span><span class="nv">$finder</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">setRiskyAllowed</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

</pre></td></tr></tbody></table></code></pre></div></div> <p>Now update the <code class="language-plaintext highlighter-rouge">./bin/generate.php</code> file so its contents are as follows:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>#!/usr/bin/env php
<span class="cp">&lt;?php</span>

<span class="k">require_once</span> <span class="k">__DIR__</span><span class="mf">.</span><span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">OpenApi\Generator</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Symfony\Component\Yaml\Yaml</span><span class="p">;</span>

<span class="nv">$openapi</span> <span class="o">=</span> <span class="nc">Generator</span><span class="o">::</span><span class="nf">scan</span><span class="p">([</span><span class="k">__DIR__</span><span class="mf">.</span><span class="s1">'/../src'</span><span class="p">]);</span>
<span class="nv">$yaml</span> <span class="o">=</span> <span class="nv">$openapi</span><span class="o">-&gt;</span><span class="nf">toYaml</span><span class="p">(</span>
    <span class="nc">Yaml</span><span class="o">::</span><span class="no">DUMP_OBJECT_AS_MAP</span>
    <span class="o">^</span> <span class="nc">Yaml</span><span class="o">::</span><span class="no">DUMP_EMPTY_ARRAY_AS_SEQUENCE</span>
    <span class="o">^</span> <span class="nc">Yaml</span><span class="o">::</span><span class="no">DUMP_MULTI_LINE_LITERAL_BLOCK</span>
<span class="p">);</span>

<span class="nv">$oas_file</span> <span class="o">=</span> <span class="k">__DIR__</span><span class="mf">.</span><span class="s1">'/../openapi.yaml'</span><span class="p">;</span>
<span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$oas_file</span><span class="p">,</span> <span class="nv">$yaml</span><span class="p">);</span>
<span class="k">echo</span> <span class="s2">"Wrote OAS file to </span><span class="si">{</span><span class="nv">$oas_file</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

<span class="k">echo</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">Running php-cs-fixer</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="nb">shell_exec</span><span class="p">(</span><span class="k">__DIR__</span><span class="mf">.</span><span class="s1">'/../vendor/bin/php-cs-fixer fix'</span><span class="p">);</span>

</pre></td></tr></tbody></table></code></pre></div></div> <p>Your annotations will be fixed every time you generate:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>./bin/generate.php

Warning: Required @OA<span class="se">\P</span>athItem<span class="o">()</span> not found <span class="k">in</span> ./vendor/zircote/swagger-php/src/Loggers/DefaultLogger.php on line 27
Wrote OAS file to ./bin/../openapi.yaml

Running php-cs-fixer
Loaded config default from <span class="s2">"./.php-cs-fixer.php"</span><span class="nb">.</span>
Using cache file <span class="s2">".php-cs-fixer.cache"</span><span class="nb">.</span>

</pre></td></tr></tbody></table></code></pre></div></div> <p>You should have ended up with this:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>tree <span class="nt">-a</span> <span class="nt">--filesfirst</span>
<span class="nb">.</span>
‚îú‚îÄ‚îÄ .php-cs-fixer.cache
‚îú‚îÄ‚îÄ .php-cs-fixer.php
‚îú‚îÄ‚îÄ composer.json
‚îú‚îÄ‚îÄ composer.lock
‚îú‚îÄ‚îÄ openapi.yaml
‚îú‚îÄ‚îÄ bin
‚îÇ   ‚îú‚îÄ‚îÄ docs.sh
‚îÇ   ‚îî‚îÄ‚îÄ generate.php
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îú‚îÄ‚îÄ OpenApi.php
‚îÇ   ‚îú‚îÄ‚îÄ Request
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ // ... empty
‚îÇ   ‚îî‚îÄ‚îÄ Response
‚îÇ       ‚îî‚îÄ‚îÄ // ... empty
‚îî‚îÄ‚îÄ vendor
    ‚îú‚îÄ‚îÄ autoload.php
    ‚îú‚îÄ‚îÄ bin
    ‚îÇ   ‚îú‚îÄ‚îÄ openapi -&gt; ../zircote/swagger-php/bin/openapi
    ‚îÇ   ‚îî‚îÄ‚îÄ php-cs-fixer -&gt; ../friendsofphp/php-cs-fixer/php-cs-fixer
    ‚îî‚îÄ‚îÄ // ... snip

</pre></td></tr></tbody></table></code></pre></div></div> <h2 id="wrapping-it-up">Wrapping It Up</h2> <p>Today we briefly spoke about the differences between Swagger and OpenAPI. We touched on the various things you can do with an OpenAPI definitions file, and some of the tools you can use to do these things.</p> <p>We have installed tools to generate our definitions file, run a documentation server, and (optionally) do some formatting of our annotations declarations.</p> <p>We even generated our first definitions file (even though it is missing some required data) and saw our documentation page (even though it‚Äôs pretty blank!).</p> <p>In the next part of this series we will start implementing actual endpoints and their parameters. Eventually we will begin adding more advanced features like authentication.</p> <p>Until next time, this is Se√±or PHP Developer Juan Treminio wishing you adios!</p> <hr class="invisible"> <ul class="pager"> <li class="previous"> <a href="/blog/all-in-one-php-fpm-nginx-apache-containers/" data-toggle="tooltip" data-placement="top" title="All-in-One PHP-FPM + Nginx/Apache Containers"> Previous &rarr;<br> <span>All-in-One PHP-FPM + Nginx/Apache Containers</span> </a> </li> </ul> <hr class="invisible"> <div class="comment"> <script src="//utteranc.es/client.js" repo="jtreminio/jtreminio.github.io" issue-number="19" theme="photon-dark" crossorigin="anonymous" async></script> </div> </div> </div> </div> </article> <footer> <div class="container"> <div class="row"> <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"> <ul class="list-inline text-center footer-icons"> <li><a href="mailto:jtreminio@gmail.com"><i data-feather="mail"></i></a></li> <li> <a href="https://github.com/jtreminio" target="_blank"> <i data-feather="github"></i> </a> </li> <li> <a href="https://twitter.com/juantreminio" target="_blank"> <i data-feather="twitter"></i> </a> </li> <li> <a href="https://www.linkedin.com/in/jtreminio-1" target="_blank"> <i data-feather="linkedin"></i> </a> </li> </ul> </div> </div> </div> </footer> </body> <script src="/static/js/custom.js?1643642128"></script> </html>